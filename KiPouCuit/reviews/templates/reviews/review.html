{% extends 'base.html' %}
{% load static %}

{% block title %}Post A Review{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'reviews/reviews.css' %}">

<div class="container">
    <div class="review-container">
        <h1 class="page-title">Post A Review</h1>

        <!-- Display success/error messages -->
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert {{ message.tags }}">
                <span>{{ message }}</span>
                {% if "success" in message.tags %}
                <a href="{% url 'review_list' %}" class="view-reviews-btn-inline">View All Reviews</a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

{% if not blocked %}
<form id="reviewForm" method="POST">
    {% csrf_token %}
    <div class="form-group">
    <label for="firstName">First name</label>
    <input 
        type="text" 
        id="firstName" 
        name="firstName" 
        required
        pattern="^[A-Za-z\s\-]+$" 
        title="First name can only contain letters, spaces, or hyphens."
        value="{{ initial_data.first_name|default:'' }}"
        {% if user.is_authenticated %} readonly {% endif %}>
    </div>

    <div class="form-group">
    <label for="lastName">Last name</label>
    <input 
        type="text" 
        id="lastName" 
        name="lastName" 
        required
        pattern="^[A-Za-z\s\-]+$" 
        title="Last name can only contain letters, spaces, or hyphens."
        value="{{ initial_data.last_name|default:'' }}"
        {% if user.is_authenticated %} readonly {% endif %}>
    </div>

    <div class="form-group">
    <label for="email">Email</label>
    <input 
        type="email" 
        id="email" 
        name="email" 
        required
        pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[A-Za-z]{2,}$"
        title="Enter a valid email address (e.g., name@example.com)"
        value="{{ initial_data.email|default:'' }}"
        {% if user.is_authenticated %} readonly {% endif %}>
    </div>


    {% comment %} <div class="form-group">
    <label for="contactNumber">Contact Number</label>
    <input 
        type="text" 
        id="contactNumber" 
        name="phone"
        pattern="^\d{8,10}$" 
        title="Contact number must contain only 8-10 digits."
        value="{{ initial_data.phone|default:'' }}"
        {% if user.is_authenticated %} readonly {% endif %}>
    </div> {% endcomment %}

    <div class="form-group">
        <label for="rating">Stars</label>
        <div class="rating-container">
            <select id="rating" name="rating" required>
                <option value="">Select a rating</option>
                <option value="1">1 Star</option>
                <option value="2">2 Stars</option>
                <option value="3">3 Stars</option>
                <option value="4">4 Stars</option>
                <option value="5">5 Stars</option>
            </select>

            <div class="rating-stars">
                <i class="fas fa-star" data-rating="1"></i>
                <i class="fas fa-star" data-rating="2"></i>
                <i class="fas fa-star" data-rating="3"></i>
                <i class="fas fa-star" data-rating="4"></i>
                <i class="fas fa-star" data-rating="5"></i>
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="message">Message</label>
        <textarea 
            id="message" 
            name="message" 
            placeholder="Share your experience..." 
            required></textarea>
    </div>

    <button type="submit" class="submit-btn">Post your Review</button>
</form>
{% endif %}
    </div>
</div>

<script>
    // Star rating functionality
    const stars = document.querySelectorAll('.rating-stars i');
    const ratingSelect = document.getElementById('rating');

    stars.forEach(star => {
        star.addEventListener('click', () => {
            const rating = star.getAttribute('data-rating');
            ratingSelect.value = rating;
            updateStars(rating);
        });

        star.addEventListener('mouseover', () => {
            const rating = star.getAttribute('data-rating');
            highlightStars(rating);
        });
    });

    document.querySelector('.rating-stars').addEventListener('mouseleave', () => {
        const currentRating = ratingSelect.value;
        updateStars(currentRating);
    });

    function updateStars(rating) {
        stars.forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }

    function highlightStars(rating) {
        stars.forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }
</script>

{% endblock %}