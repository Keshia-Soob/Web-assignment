{% extends "base.html" %}
{% load static %}

{% block title %}Homecook Log{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'homecook/css/homecook_log.css' %}">

<div class="homecook-container">
  <!-- Homecook Profile -->
  <div class="homecook-profile">
    {% if homecook and homecook.profile_picture %}
      {# 1. If HomeCook has its own picture, use it #}
      <img src="{{ homecook.profile_picture.url }}" alt="Profile Picture" class="profile-pic">
    {% elif homecook and homecook.user.userprofile.photo %}
      {# 2. Otherwise, fall back to the user's profile photo #}
      <img src="{{ homecook.user.userprofile.photo.url }}" alt="Profile Picture" class="profile-pic">
    {% else %}
      {# 3. Otherwise, show the default icon #}
      <img src="{% static 'homecook/images/profile.png' %}" alt="Profile Picture" class="profile-pic">
    {% endif %}

    {% if homecook %}
      <h2 class="homecook-name">{{ homecook.name }} {{ homecook.surname }}</h2>
      <p class="homecook-specialty">{{ homecook.get_cuisine_display }}</p>
    {% else %}
      <h2 class="homecook-name">HomeCook</h2>
      <p class="homecook-specialty">â€”</p>
    {% endif %}
  </div>

  <!-- Orders Section -->
  <div class="orders-section">
    <h3>Available Orders (Unclaimed)</h3>
    {% if available_items %}
      {% for it in available_items %}
      <div class="order-item">
        <div class="dish-info">
          <img src="{{ it.menu_item.display_image_url }}" alt="Meal" class="dish-image">
          <div class="dish-details">
            <h4>{{ it.menu_item.name }}</h4>
            {% if it.order %}
              <p>Client: <strong>{{ it.order.client_name }}</strong></p>
              {% if it.order.user and it.order.user.userprofile.address %}
                <p>Address: {{ it.order.user.userprofile.address }}</p>
              {% else %}
                <p>Address: Not provided</p>
              {% endif %}
            {% else %}
              <p>Client: <strong>Unknown</strong></p>
            {% endif %}
            <p>Qty: {{ it.quantity }}</p>
          </div>
        </div>
        <div class="order-actions">
          <form action="{% url 'accept_order' it.id %}" method="post">
            {% csrf_token %}
            <button class="accept-btn" type="submit">Accept</button>
          </form>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p>No available orders right now.</p>
    {% endif %}

    <h3>Your Orders</h3>
    {% if my_items %}
      {% for it in my_items %}
      <div class="order-item">
        <div class="dish-info">
          <img src="{{ it.menu_item.display_image_url }}" alt="Meal" class="dish-image">
          <div class="dish-details">
            <h4>{{ it.menu_item.name }}</h4>
            <p>Qty: {{ it.quantity }}</p>
            <p>Status: <strong>
              {% if it.status == 'accepted' %}Accepted{% elif it.status == 'delivering' %}Being delivered{% else %}{{ it.get_status_display }}{% endif %}
            </strong></p>
          </div>
        </div>
        <div class="order-actions">
          {% if it.status == 'accepted' %}
            <form action="{% url 'mark_ready' it.id %}" method="post">
              {% csrf_token %}
              <button class="mark-ready" type="submit">Mark as Ready</button>
            </form>
          {% elif it.status == 'delivering' %}
            <form action="{% url 'mark_delivered' it.id %}" method="post">
              {% csrf_token %}
              <button class="mark-ready" type="submit">Mark as Delivered</button>
            </form>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p>You have no accepted orders.</p>
    {% endif %}
  </div>

</div>
{% endblock %}