{% extends 'base.html' %}
{% load static %}

{% block title %}KiPouCuit - About{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'main_page/about.css' %}">

<main class="main-content">
    <!-- Hero Section -->
    <section class="about-hero">
        <div class="container">
            <div class="hero-content">
                <span class="label">Proven strategies backed by science</span>
                <h1>About KiPouCuit</h1>
                <p>We help people discover their true potential and live a fulfilling life. Discover the simple steps we use to create delicious, homemade meals backed by tradition and science. Ready to transform your dining experience?</p>
                <a href="{% url 'home' %}" class="btn">Explore More</a>
            </div>
            <div class="hero-image">
                <img src="{% static 'main_page/assets/about1.png' %}" alt="About Us">
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <h2>What Makes Us Different</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="icon">
                        <img src="{% static 'main_page/assets/about2.jpg' %}" alt="Free Shipping">
                    </div>
                    <h3>Free Delivery</h3>
                    <p>Enjoy free delivery on all orders!</p>
                </div>
                <div class="feature-card featured">
                    <div class="icon">
                        <img src="{% static 'main_page/assets/about3.jpg' %}" alt="15 Days Returns">
                    </div>
                    <h3>Freshness Guarantee</h3>
                    <p>Cash back is provided for genuine dissatisfaction.</p>
                </div>
                <div class="feature-card">
                    <div class="icon">
                        <img src="{% static 'main_page/assets/about4.jpg' %}" alt="Secure Checkout">
                    </div>
                    <h3>Secure Checkout</h3>
                    <p>Your data is protected with secure payments</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Chef Delivery Section -->
    <section class="chef-delivery">
        <div class="container chef-delivery-container">
            <div class="chef-image">
                <img src="{% static 'main_page/assets/about10.jpg' %}" alt="Smiling Chef">
            </div>
            <div class="chef-content">
                <span class="label">Home Delivery</span>
                <h2>Sit at Home, We'll Take Care of Your Order</h2>
                <p>From our kitchen to your doorstep-fresh, fast, and full of flavor. Let us handle the cooking while you enjoy the comfort.</p>
                <div class="bike-highlight">
                    <img src="{% static 'main_page/assets/about9.jpg' %}" alt="Bike Icon">
                    <span>We deliver your food by bike as quickly as possible.</span>
                </div>
                <a href="{% url 'menu' %}" class="btn">Order Now</a>
            </div>
        </div>
    </section>
</main>

<!-- Testimonial Section -->
<section class="testimonial">
    <div class="container">
        <h2>What Our Customers Say</h2>

        {% if latest_reviews %}
        <div class="slider-container">
            <button class="slider-arrow prev" aria-label="Previous testimonial">&#10094;</button>
            <div class="slider-wrapper">
                <div class="slider-track">
                    {% for item in latest_reviews %}
                    {% with review=item.review %}
                    <div class="testimonial-card">
                        {% if item.photo %}
                            <img src="{{ item.photo }}" alt="{{ review.first_name }} {{ review.last_name }}">
                        {% else %}
                            <img src="{% static 'main_page/assets/default_user.png' %}" alt="{{ review.first_name }} {{ review.last_name }}">
                        {% endif %}
                        <div class="testimonial-content">
                            <h3>{{ review.first_name }} {{ review.last_name }}</h3>
                            <p>"{{ review.message }}"</p>
                            <div class="rating">
                                {% for i in "12345"|make_list %}
                                    <span>{% if forloop.counter <= review.rating %}★{% else %}☆{% endif %}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                    {% endfor %}
                </div>
            </div>
            <button class="slider-arrow next" aria-label="Next testimonial">&#10095;</button>
        </div>
        {% else %}
        <div class="no-reviews">
            <p>No reviews available yet. Be the first to leave one!</p>
        </div>
        {% endif %}

        <div class="review-button-wrapper">
            <a href="{% url 'review' %}" class="btn leave-review-btn">Leave a Review</a>
        </div>
    </div>
</section> 

<!-- App Download Section -->
<section class="app-download">
    <div class="container app-download-container">
        <div class="app-visual">
            <img src="{% static 'main_page/assets/about6.jpg' %}" alt="Download App">
        </div>
        <div class="app-info">
            <h2>Download Our App</h2>
            <p>Get the Food app order more easily. Enjoy seamless ordering, exclusive deals, and fast checkout, all from your phone.</p>
            <p class="placeholder">Your cravings, delivered fast, fresh, and fuss-free.</p>
            <div class="store-buttons">
                <a href="#" class="store-btn">
                    <img src="{% static 'main_page/assets/about7.jpg' %}" alt="App Store">
                    App Store
                </a>
                <a href="#" class="store-btn">
                    <img src="{% static 'main_page/assets/about8.jpg' %}" alt="Play Store">
                    Play Store
                </a>
            </div>
        </div>
    </div>
</section>

<!-- JS for Testimonial Slider -->
<script>
// Check if slider elements exist before initializing
const sliderWrapper = document.querySelector('.slider-wrapper');
const sliderTrack = document.querySelector('.slider-track');
const prevBtn = document.querySelector('.slider-arrow.prev');
const nextBtn = document.querySelector('.slider-arrow.next');
const cards = document.querySelectorAll('.testimonial-card');

if (sliderWrapper && sliderTrack && prevBtn && nextBtn && cards.length > 0) {
    let currentIndex = 0;
    const totalCards = cards.length;

    function updateSlider() {
        // Dynamically calculate card width and gap from actual rendered elements
        const cardWidth = cards[0].offsetWidth;
        const trackStyles = window.getComputedStyle(sliderTrack);
        const gap = parseInt(trackStyles.gap) || 30;
        
        // Calculate offset to center the current card
        const offset = currentIndex * (cardWidth + gap);
        sliderTrack.style.transform = `translateX(-${offset}px)`;
        
        // Disable/enable buttons based on position
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === totalCards - 1;
        
        // Update button opacity for visual feedback
        if (currentIndex === 0) {
            prevBtn.style.opacity = '0.3';
            prevBtn.style.cursor = 'not-allowed';
        } else {
            prevBtn.style.opacity = '1';
            prevBtn.style.cursor = 'pointer';
        }
        
        if (currentIndex === totalCards - 1) {
            nextBtn.style.opacity = '0.3';
            nextBtn.style.cursor = 'not-allowed';
        } else {
            nextBtn.style.opacity = '1';
            nextBtn.style.cursor = 'pointer';
        }
    }

    prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
            currentIndex--;
            updateSlider();
        }
    });

    nextBtn.addEventListener('click', () => {
        if (currentIndex < totalCards - 1) {
            currentIndex++;
            updateSlider();
        }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' && currentIndex > 0) {
            currentIndex--;
            updateSlider();
        } else if (e.key === 'ArrowRight' && currentIndex < totalCards - 1) {
            currentIndex++;
            updateSlider();
        }
    });

    // Initialize slider after page loads completely
    window.addEventListener('load', () => {
        updateSlider();
    });

    // Adjust on window resize
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            updateSlider();
        }, 250);
    });
}

if (sliderWrapper && sliderTrack && prevBtn && nextBtn && cards.length > 0) {
    let currentIndex = 0;
    const totalCards = cards.length;

    // Touch/swipe variables
    let touchStartX = 0;
    let touchEndX = 0;
    let isDragging = false;

    function updateSlider() {
        const cardWidth = cards[0].offsetWidth;
        const trackStyles = window.getComputedStyle(sliderTrack);
        const gap = parseInt(trackStyles.gap) || 30;
        const offset = currentIndex * (cardWidth + gap);
        sliderTrack.style.transform = `translateX(-${offset}px)`;
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === totalCards - 1;
    }

    function goToNext() {
        if (currentIndex < totalCards - 1) {
            currentIndex++;
            updateSlider();
        }
    }

    function goToPrev() {
        if (currentIndex > 0) {
            currentIndex--;
            updateSlider();
        }
    }

    // Button click handlers
    prevBtn.addEventListener('click', goToPrev);
    nextBtn.addEventListener('click', goToNext);

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') goToPrev();
        else if (e.key === 'ArrowRight') goToNext();
    });

    // Touch/Swipe handlers
    function handleTouchStart(e) {
        touchStartX = e.changedTouches[0].screenX;
        isDragging = true;
        sliderTrack.style.transition = 'none'; // Disable transition during drag
    }

    function handleTouchMove(e) {
        if (!isDragging) return;
        touchEndX = e.changedTouches[0].screenX;
    }

    function handleTouchEnd() {
        if (!isDragging) return;
        isDragging = false;
        sliderTrack.style.transition = 'transform 0.5s ease-in-out'; // Re-enable transition

        const swipeThreshold = 50; // Minimum swipe distance in pixels
        const swipeDistance = touchStartX - touchEndX;

        if (Math.abs(swipeDistance) > swipeThreshold) {
            if (swipeDistance > 0) {
                // Swiped left - go to next
                goToNext();
            } else {
                // Swiped right - go to previous
                goToPrev();
            }
        } else {
            // If swipe was too short, reset to current position
            updateSlider();
        }

        touchStartX = 0;
        touchEndX = 0;
    }

    // Add touch event listeners to slider wrapper
    sliderWrapper.addEventListener('touchstart', handleTouchStart, { passive: true });
    sliderWrapper.addEventListener('touchmove', handleTouchMove, { passive: true });
    sliderWrapper.addEventListener('touchend', handleTouchEnd);

    // Handle window resize
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(updateSlider, 250);
    });
}

</script>

{% endblock %}